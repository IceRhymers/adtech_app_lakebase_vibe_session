# The main job for adtech_vector_chat.
resources:
  jobs:
    adtech_vector_chat_job:
      name: adtech_vector_chat_job

      schedule:
        quartz_cron_expression: '0 0 * * * ?'  # Run every hour
        timezone_id: UTC
        pause_status: UNPAUSED

      #email_notifications:
      #  on_failure:
      #    - your_email@example.com

      tasks:
        - task_key: postgres_catalog
          notebook_task:
            notebook_path: ../data_pipelines/src/00-postgres-catalog.ipynb
            base_parameters:
              db_instance_name: tannerw-adtech-db
              db_database_name: databricks_postgres
              catalog_name: tanner_wendland_postgres_adtech

        - task_key: chat_history_sync
          notebook_task:
            notebook_path: ../data_pipelines/src/01-sync-chat-history.ipynb
            base_parameters:
              source_table_catalog: tanner_wendland_postgres_adtech
              source_table_database: public
              vector_search_endpoint: one-env-shared-endpoint-7
              sink_catalog: tanner_wendland
              sink_schema: default
          depends_on:
            - task_key: postgres_catalog

    adtech_chat_history_agent_job:
      name: adtech_chat_history_agent_job

      tasks:
        - task_key: adtech_chat_history_agent
          notebook_task:
            notebook_path: ../data_pipelines/src/02-chat-history-agent.ipynb
            base_parameters:
              target_catalog: tanner_wendland
              target_schema: default
              vector_search_endpoint: one-env-shared-endpoint-7
              vector_search_index: tanner_wendland.default.chat_history_index
              llm_model_serving_endpoint_name: databricks-claude-3-7-sonnet